// å¼·åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
export class PromptGenerator {
  constructor(userInputs) {
    this.userInputs = userInputs || {};
    this.validateInputs();
  }

  validateInputs() {
    const required = ['keywords', 'readerPersona', 'writerCharacter'];
    const missing = required.filter(key => !this.userInputs[key]);
    
    if (missing.length > 0) {
      console.warn(`Missing required inputs: ${missing.join(', ')}`);
      // ä¸è¶³ã—ã¦ã„ã‚‹é …ç›®ã‚’åˆæœŸåŒ–
      if (!this.userInputs.keywords) this.userInputs.keywords = [];
      if (!this.userInputs.readerPersona) this.userInputs.readerPersona = {};
      if (!this.userInputs.writerCharacter) this.userInputs.writerCharacter = {};
    }
    
    // ãã®ä»–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚åˆæœŸåŒ–
    if (!this.userInputs.primaryInfo) this.userInputs.primaryInfo = {};
    if (!this.userInputs.writingStyle) this.userInputs.writingStyle = {};
    if (!this.userInputs.wordCount) this.userInputs.wordCount = 3000;
  }

  // å¼·åŒ–ã•ã‚ŒãŸãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
  generateMainPrompt() {
    const { keywords, readerPersona, writerCharacter, primaryInfo, writingStyle, wordCount, purpose } = this.userInputs;

    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹æˆè¦ç´ ã‚’è©³ç´°ã«çµ„ã¿ç«‹ã¦
    const sections = [];

    // 1. å½¹å‰²ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šï¼ˆè©³ç´°åŒ–ï¼‰
    sections.push(this.buildDetailedRoleSection());

    // 2. å…·ä½“çš„ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆèª­è€…è¨­å®š
    sections.push(this.buildDetailedTargetSection());

    // 3. æ–‡ä½“ãƒ»å£èª¿ã®è©³ç´°æŒ‡å®š
    sections.push(this.buildDetailedToneSection());

    // 4. ä¸€æ¬¡æƒ…å ±ã®æ´»ç”¨æŒ‡ç¤º
    sections.push(this.buildPrimaryInfoSection());

    // 5. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰çµ±åˆæŒ‡ç¤ºã¨ç›®çš„ï¼ˆå¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
    sections.push(this.buildKeywordAndPurposeSection());

    // 6. æ§‹æˆã¨æ–‡å­—æ•°ã®æ˜ç¢ºåŒ–
    sections.push(this.buildStructureAndWordCountSection());
    
    // 7. å‡ºåŠ›å“è³ªã®è¦æ±‚
    sections.push(this.buildQualityRequirementsSection());
    
    // 8. å…·ä½“çš„ãªåŸ·ç­†æŒ‡ç¤º
    sections.push(this.buildConcreteWritingInstructions());

    return sections.filter(Boolean).join('\n\n');
  }

  // è©³ç´°ãªå½¹å‰²è¨­å®š
  buildDetailedRoleSection() {
    const { writerCharacter } = this.userInputs;
    
    let roleSection = `# ã‚ãªãŸã®å½¹å‰²ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š\n\n`;
    
    // åŸºæœ¬æƒ…å ±
    roleSection += `## åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«\n`;
    roleSection += `- å¹´é½¢: ${writerCharacter?.age || '30'}æ­³\n`;
    roleSection += `- è·æ¥­: ${writerCharacter?.occupation || 'ãƒ©ã‚¤ã‚¿ãƒ¼'}\n`;
    
    // æ€§æ ¼ç‰¹æ€§ï¼ˆå…·ä½“çš„ãªè¡Œå‹•æŒ‡ç¤ºä»˜ãï¼‰
    if (writerCharacter?.personalities?.length > 0) {
      roleSection += `- æ€§æ ¼: ${writerCharacter.personalities.join('ã€')}\n`;
      roleSection += `\n## æ€§æ ¼ã®æ–‡ç« ã¸ã®åæ˜ æ–¹æ³•:\n`;
      
      writerCharacter.personalities.forEach(personality => {
        const behaviorGuide = this.getPersonalityBehaviorGuide(personality);
        roleSection += `- ${personality}: ${behaviorGuide}\n`;
      });
    }
    
    // æ›¸ãå‹•æ©Ÿã¨æƒ…ç†±
    if (writerCharacter?.motivations?.length > 0) {
      roleSection += `\n## åŸ·ç­†å‹•æ©Ÿ:\n`;
      roleSection += `${writerCharacter.motivations.join('ã€')}ã¨ã„ã†å¼·ã„æƒ³ã„ã§è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã¾ã™ã€‚\n`;
      roleSection += `ã“ã®å‹•æ©Ÿã‚’æ–‡ç« ã®ç«¯ã€…ã«æ„Ÿã˜ã‚‰ã‚Œã‚‹ã‚ˆã†ãªæ¸©åº¦æ„Ÿã§åŸ·ç­†ã—ã¦ãã ã•ã„ã€‚\n`;
    }
    
    roleSection += `\n**é‡è¦**: ä¸Šè¨˜ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’å˜ãªã‚‹æƒ…å ±ã¨ã—ã¦æ‰±ã‚ãšã€æ–‡ç« ã®ä¸€ã¤ä¸€ã¤ã®è¡¨ç¾ã«åæ˜ ã•ã›ã¦ãã ã•ã„ã€‚`;
    
    return roleSection;
  }

  // æ€§æ ¼ç‰¹æ€§ã®å…·ä½“çš„ãªè¡Œå‹•æŒ‡ç¤º
  getPersonalityBehaviorGuide(personality) {
    const guides = {
      'è¦ªã—ã¿ã‚„ã™ã„': 'èª­è€…ã‚’ã€Œã‚ãªãŸã€ã¨å‘¼ã³ã€å…±æ„Ÿçš„ãªè¡¨ç¾ã‚’å¤šç”¨ã—ã€ä½“é¨“è«‡ã‚’äº¤ãˆã¦è·é›¢æ„Ÿã‚’ç¸®ã‚ã‚‹ã€‚ä¾‹ï¼šã€Œç§ã‚‚åŒã˜çµŒé¨“ãŒã‚ã‚Šã¾ã™ã€ã€Œã‚ãªãŸãªã‚‰ã©ã†æ€ã„ã¾ã™ã‹ï¼Ÿã€',
      'çœŸé¢ç›®': 'è«–ç†çš„ã§æ§‹é€ åŒ–ã•ã‚ŒãŸèª¬æ˜ã‚’å¿ƒãŒã‘ã€æ ¹æ‹ ã‚’æ˜ç¢ºã«ç¤ºã—ã€è²¬ä»»æ„Ÿã®ã‚ã‚‹è¨€è‘‰é£ã„ã‚’ä½¿ã†ã€‚ä¾‹ï¼šã€Œãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹ã¨ã€ã€Œç ”ç©¶çµæœã‹ã‚‰ã€',
      'æƒ…ç†±çš„': 'æ„Ÿå˜†ç¬¦ã‚„å¼·èª¿è¡¨ç¾ã‚’é©åº¦ã«ä½¿ã„ã€ç†±ã„æƒ³ã„ãŒä¼ã‚ã‚‹åŠ›å¼·ã„æ–‡ç« ã‚’æ›¸ãã€‚ä¾‹ï¼šã€Œæœ¬å½“ã«ç´ æ™´ã‚‰ã—ã„ã‚“ã§ã™ï¼ã€ã€Œçµ¶å¯¾ã«çŸ¥ã£ã¦ãŠãã¹ãã€',
      'å†·é™': 'å®¢è¦³çš„ãªåˆ†æã‚’é‡è¦–ã—ã€æ„Ÿæƒ…çš„ãªè¡¨ç¾ã‚’æ§ãˆã‚ã«ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚„äº‹å®Ÿã‚’åŸºã«è«–è¿°ã™ã‚‹ã€‚ä¾‹ï¼šã€Œå®¢è¦³çš„ã«è¦‹ã‚‹ã¨ã€ã€Œäº‹å®Ÿã¨ã—ã¦ã€',
      'å„ªã—ã„': 'èª­è€…ã®æ°—æŒã¡ã«å¯„ã‚Šæ·»ã†è¡¨ç¾ã‚’ä½¿ã„ã€æ‰¹åˆ¤çš„ãªè¨€è‘‰ã‚’é¿ã‘ã€åŠ±ã¾ã—ã®è¨€è‘‰ã‚’å«ã‚ã‚‹ã€‚ä¾‹ï¼šã€Œå¤§ä¸ˆå¤«ã§ã™ã‚ˆã€ã€Œä¸€ç·’ã«é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€',
      'ãƒ¦ãƒ¼ãƒ¢ã‚¢ãŒã‚ã‚‹': 'é©åº¦ãªè»½å¿«ã•ã‚’ä¿ã¡ã€è¦ªã—ã¿ã‚„ã™ã„ä¾‹ãˆã‚„æ¯”å–©ã‚’ä½¿ã„ã€èª­è€…ã‚’æ¥½ã—ã¾ã›ã‚‹è¦ç´ ã‚’å…¥ã‚Œã‚‹ã€‚ä¾‹ï¼šã€Œã¾ã‚‹ã§ã€œã®ã‚ˆã†ãªã€ã€Œå®Ÿã¯ç§ã‚‚æœ€åˆã¯ã€œã§ã—ãŸã€'
    };
    
    return guides[personality] || 'å€‹æ€§ã‚’æ–‡ç« ã«åæ˜ ã•ã›ã‚‹';
  }

  // è©³ç´°ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆèª­è€…è¨­å®š
  buildDetailedTargetSection() {
    const { readerPersona } = this.userInputs;
    
    let targetSection = `# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆèª­è€…ã®è©³ç´°è¨­å®š\n\n`;
    
    // åŸºæœ¬å±æ€§ã‹ã‚‰å…·ä½“çš„ãªèª­è€…åƒã¸å¤‰æ›
    targetSection += `## èª­è€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¨å¿ƒç†ç‰¹æ€§\n`;
    targetSection += `**ã‚ãªãŸãŒè©±ã—ã‹ã‘ã¦ã„ã‚‹èª­è€…ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªäººã§ã™ï¼š**\n`;
    
    // å¹´é½¢ã‚„è·æ¥­ã‹ã‚‰æ¨æ¸¬ã•ã‚Œã‚‹ç‰¹æ€§
    if (readerPersona?.age || readerPersona?.occupation) {
      targetSection += `- ${this.getReaderLifestageDescription(readerPersona?.age, readerPersona?.occupation)}\n`;
    } else {
      targetSection += `- æ—¥ã€…ã®å¿™ã—ã•ã®ä¸­ã§ã‚‚è‡ªå·±æˆé•·ã‚’æ±‚ã‚ã¦ã„ã‚‹äºº\n`;
    }
    
    // èª­æ›¸ã‚¹ã‚¿ã‚¤ãƒ«ã«å¿œã˜ãŸæ–‡ç« æ§‹æˆ
    if (readerPersona?.readingStyle) {
      targetSection += `- ${this.getReadingStyleApproach(readerPersona.readingStyle)}\n`;
    }
    
    // èˆˆå‘³é–¢å¿ƒã¸ã®å…·ä½“çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
    if (readerPersona?.interests?.length > 0) {
      targetSection += `\n## èª­è€…ã®é–¢å¿ƒäº‹ã¨è¨´æ±‚ãƒã‚¤ãƒ³ãƒˆ:\n`;
      readerPersona.interests.forEach(interest => {
        targetSection += `- ${interest}ã«é–¢å¿ƒãŒã‚ã‚‹ â†’ ${this.getInterestAppeal(interest)}\n`;
      });
    }
    
    // èª²é¡Œã¸ã®å…±æ„Ÿçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
    if (readerPersona?.challenges?.length > 0) {
      targetSection += `\n## èª­è€…ã®èª²é¡Œã¸ã®å…±æ„Ÿã¨è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:\n`;
      readerPersona.challenges.forEach(challenge => {
        targetSection += `- ${challenge}ã¨ã„ã†æ‚©ã¿ã‚’æŒã¤ â†’ ${this.getChallengeApproach(challenge)}\n`;
      });
    }
    
    targetSection += `\n**é‡è¦**: èª­è€…ã®å±æ€§æƒ…å ±ã‚’å˜ã«èª¬æ˜ã™ã‚‹ã®ã§ã¯ãªãã€ä¸Šè¨˜ã®ç‰¹æ€§ã‚’æŒã¤å…·ä½“çš„ãªäººç‰©ã«ç›´æ¥èªã‚Šã‹ã‘ã‚‹ã‚ˆã†ã«æ–‡ç« ã‚’æ§‹æˆã—ã¦ãã ã•ã„ã€‚èª­è€…ãŒã¾ã•ã«ã€Œè‡ªåˆ†ã®ã“ã¨ã‚’ç†è§£ã—ã¦ãã‚Œã¦ã„ã‚‹ã€ã¨æ„Ÿã˜ã‚‹å†…å®¹ã«ã—ã¾ã—ã‚‡ã†ã€‚`;
    
    return targetSection;
  }

  // å¹´é½¢ã¨è·æ¥­ã‹ã‚‰èª­è€…ã®ç”Ÿæ´»çŠ¶æ³ã‚’æ¨æ¸¬
  getReaderLifestageDescription(age, occupation) {
    if (!age && !occupation) return 'å¤šæ§˜ãªèƒŒæ™¯ã‚’æŒã¤èª­è€…';
    
    let description = '';
    
    // å¹´é½¢ã«ã‚ˆã‚‹ç‰¹æ€§
    if (age) {
      switch (age) {
        case '10ä»£':
          description = 'å°†æ¥ã¸ã®ä¸å®‰ã¨å¯èƒ½æ€§ã‚’æŒã¡ã€è‡ªåˆ†ã®é€²è·¯ã‚’æ¨¡ç´¢ã—ã¦ã„ã‚‹';
          break;
        case '20ä»£':
          description = 'ã‚­ãƒ£ãƒªã‚¢å½¢æˆã®åˆæœŸæ®µéšã§ã€ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã¨çµŒé¨“ã‚’æ±‚ã‚ã¦ã„ã‚‹';
          break;
        case '30ä»£':
          description = 'ã‚­ãƒ£ãƒªã‚¢ã¨ç§ç”Ÿæ´»ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ¨¡ç´¢ã—ã€å°‚é–€æ€§ã‚’æ·±ã‚ãŸã„';
          break;
        case '40ä»£':
          description = 'è²¬ä»»ã‚ã‚‹ãƒã‚¸ã‚·ãƒ§ãƒ³ã§ã‚ã‚ŠãªãŒã‚‰ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚„å¤‰åŒ–ã‚‚è€ƒãˆã¦ã„ã‚‹';
          break;
        case '50ä»£ä»¥ä¸Š':
          description = 'è±Šå¯ŒãªçµŒé¨“ã‚’æŒã¡ãªãŒã‚‰ã‚‚ã€æ–°ã—ã„æ™‚ä»£ã¸ã®é©å¿œã‚’æ„è­˜ã—ã¦ã„ã‚‹';
          break;
        default:
          description = 'è‡ªå·±æˆé•·ã‚’æ±‚ã‚ã¦ã„ã‚‹';
      }
    }
    
    // è·æ¥­ã«ã‚ˆã‚‹ç‰¹æ€§ã®è¿½åŠ 
    if (occupation) {
      if (occupation.includes('ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢') || occupation.includes('é–‹ç™º')) {
        description += 'ã€æŠ€è¡“çš„ãªè©³ç´°ã¨å®Ÿè·µçš„ãªå¿œç”¨ã‚’é‡è¦–ã™ã‚‹';
      } else if (occupation.includes('ãƒãƒ¼ã‚±') || occupation.includes('åºƒå ±')) {
        description += 'ã€ãƒˆãƒ¬ãƒ³ãƒ‰ã‚„ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæˆ¦ç•¥çš„è¦–ç‚¹ã‚’æŒã¤';
      } else if (occupation.includes('å–¶æ¥­') || occupation.includes('ã‚»ãƒ¼ãƒ«ã‚¹')) {
        description += 'ã€å®Ÿç”¨çš„ã§æˆæœã«ç›´çµã™ã‚‹å†…å®¹ã‚’æ±‚ã‚ã‚‹';
      } else if (occupation.includes('çµŒå–¶') || occupation.includes('ç®¡ç†è·')) {
        description += 'ã€çµ„ç¹”å…¨ä½“ã‚’è¦‹æ¸¡ã™è¦–ç‚¹ã¨åŠ¹ç‡åŒ–ã‚’é‡è¦–ã™ã‚‹';
      } else if (occupation.includes('ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼') || occupation.includes('ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼')) {
        description += 'ã€å‰µé€ æ€§ã¨è¡¨ç¾åŠ›ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã‚‹';
      } else if (occupation.includes('å­¦ç”Ÿ')) {
        description += 'ã€å°†æ¥ã®ã‚­ãƒ£ãƒªã‚¢ã«å½¹ç«‹ã¤çŸ¥è­˜ã‚„ã‚¹ã‚­ãƒ«ã‚’å¸åã—ãŸã„';
      } else {
        description += `ã€${occupation}ã¨ã—ã¦ã®å°‚é–€æ€§ã¨æ—¥å¸¸ã®èª²é¡Œè§£æ±ºã‚’ä¸¡ç«‹ã—ãŸã„`;
      }
    }
    
    return description;
  }

  // èª­æ›¸ã‚¹ã‚¿ã‚¤ãƒ«ã«åˆã‚ã›ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
  getReadingStyleApproach(style) {
    switch (style) {
      case 'ã˜ã£ãã‚Šèª­ã‚€':
        return 'æ·±ã„æ´å¯Ÿã¨è©³ç´°ãªèª¬æ˜ã‚’è©•ä¾¡ã™ã‚‹èª­è€…ãªã®ã§ã€ä¸å¯§ãªè§£èª¬ã¨è±Šå¯Œãªä¾‹ã‚’æä¾›ã™ã‚‹';
      case 'æµã—èª­ã¿':
        return 'è¦ç‚¹ã‚’ç´ æ—©ãæŠŠæ¡ã—ãŸã„èª­è€…ãªã®ã§ã€è¦‹å‡ºã—ã¨ç®‡æ¡æ›¸ãã§é‡è¦ãƒã‚¤ãƒ³ãƒˆã‚’æ˜ç¢ºã«ã™ã‚‹';
      case 'é‡è¦éƒ¨åˆ†ã ã‘':
        return 'å¿…è¦ãªæƒ…å ±ã ã‘ã‚’åŠ¹ç‡çš„ã«å¾—ãŸã„èª­è€…ãªã®ã§ã€ãƒã‚¤ãƒ©ã‚¤ãƒˆã¨ç°¡æ½”ãªè¦ç´„ã‚’éšæ‰€ã«å…¥ã‚Œã‚‹';
      case 'ã‚¹ãƒãƒ›ã§éš™é–“æ™‚é–“':
        return 'çŸ­ã„æ™‚é–“ã§ä¾¡å€¤ã‚ã‚‹æƒ…å ±ã‚’å¾—ãŸã„èª­è€…ãªã®ã§ã€ç°¡æ½”ãªæ®µè½ã¨è¦–è¦šçš„ãªåŒºåˆ‡ã‚Šã‚’å¤šç”¨ã™ã‚‹';
      default:
        return 'åŠ¹ç‡çš„ã«ä¾¡å€¤ã‚ã‚‹æƒ…å ±ã‚’å¾—ãŸã„èª­è€…';
    }
  }

  // èˆˆå‘³é–¢å¿ƒã«åŸºã¥ã„ãŸè¨´æ±‚ãƒã‚¤ãƒ³ãƒˆ
  getInterestAppeal(interest) {
    const appeals = {
      'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°': 'ã‚³ãƒ¼ãƒ‰ã®å®Ÿä¾‹ã‚„å®Ÿè·µçš„ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’äº¤ãˆã¦è§£èª¬ã—ã€ã‚¹ã‚­ãƒ«å‘ä¸Šã«ã¤ãªãŒã‚‹å†…å®¹ã‚’æä¾›',
      'ãƒ‡ã‚¶ã‚¤ãƒ³': 'è¦–è¦šçš„ãªä¾‹ã¨å‰µé€ çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’é‡è¦–ã—ã€ç¾çš„ã‚»ãƒ³ã‚¹ã¨å®Ÿç”¨æ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ„è­˜',
      'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°': 'ãƒ‡ãƒ¼ã‚¿ã¨æˆåŠŸäº‹ä¾‹ã‚’åŸºã«æˆ¦ç•¥çš„æ€è€ƒã‚’ä¿ƒã—ã€å…·ä½“çš„ãªæˆæœã«ã¤ãªãŒã‚‹æ–¹æ³•è«–ã‚’æç¤º',
      'ãƒ“ã‚¸ãƒã‚¹': 'å®Ÿå‹™ã«ç›´çµã™ã‚‹çŸ¥è¦‹ã¨åŠ¹ç‡åŒ–ã®ãƒã‚¤ãƒ³ãƒˆã‚’æä¾›ã—ã€ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’å¼·èª¿',
      'ã‚­ãƒ£ãƒªã‚¢': 'é•·æœŸçš„ãªæˆé•·è¦–ç‚¹ã¨ã‚¹ã‚­ãƒ«æ´»ç”¨ã®å…·ä½“ä¾‹ã‚’ç¤ºã—ã€ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹ã®é¸æŠè‚¢ã‚’åºƒã’ã‚‹å†…å®¹ã«',
      'ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—': 'æŒ‘æˆ¦ã¨å‰µé€ ã®ä¾¡å€¤ã‚’å¼·èª¿ã—ã€ãƒªã‚¹ã‚¯ã¨æ©Ÿä¼šã®ãƒãƒ©ãƒ³ã‚¹ã‚’å®Ÿä¾‹ã§ç¤ºã™',
      'ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹': 'è‡ªå¾‹ã¨è‡ªç”±ã®å®Ÿç¾æ–¹æ³•ã¨ã€å®‰å®šæ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ææ¡ˆ',
      'å‰¯æ¥­': 'æœ¬æ¥­ã¨ã®ãƒãƒ©ãƒ³ã‚¹ã‚„æ™‚é–“ç®¡ç†ã®å·¥å¤«ã‚’é‡è¦–ã—ã€æŒç¶šå¯èƒ½ãªå–ã‚Šçµ„ã¿æ–¹ã‚’ææ¡ˆ',
      'æŠ•è³‡': 'ãƒªã‚¹ã‚¯ç®¡ç†ã¨é•·æœŸçš„è¦–ç‚¹ã‚’å¼·èª¿ã—ã€æ„Ÿæƒ…ã«å·¦å³ã•ã‚Œãªã„åˆç†çš„åˆ¤æ–­ã‚’ä¿ƒã™',
      'ãƒ©ã‚¤ãƒ•ãƒãƒƒã‚¯': 'æ—¥å¸¸ã®å°ã•ãªå·¥å¤«ãŒç©ã¿é‡ãªã‚‹å¤§ããªåŠ¹æœã‚’ç¤ºã—ã€ã™ãã«å®Ÿè·µã§ãã‚‹å…·ä½“ä¾‹ã‚’å¤šæ•°æä¾›'
    };
    
    return appeals[interest] || `${interest}ã«é–¢ã™ã‚‹å…·ä½“çš„ã§å®Ÿç”¨çš„ãªæƒ…å ±ã‚’æä¾›`;
  }

  // èª²é¡Œã«å¯¾ã™ã‚‹å…±æ„Ÿã¨è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
  getChallengeApproach(challenge) {
    const approaches = {
      'æ™‚é–“ãŒãªã„': 'ã€Œç§ã‚‚å¸¸ã«æ™‚é–“ã¨ã®æˆ¦ã„ã§ã™ã€ã¨å…±æ„Ÿã—ã¤ã¤ã€5åˆ†ã§ã‚‚åŠ¹æœçš„ã«å®Ÿè·µã§ãã‚‹æ–¹æ³•ã‚’å„ªå…ˆçš„ã«ç´¹ä»‹',
      'ã‚¹ã‚­ãƒ«ä¸è¶³': 'ã€Œèª°ã‚‚ãŒæœ€åˆã¯åˆå¿ƒè€…ã§ã™ã€ã¨å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã€ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã§ã®ä¸Šé”æ–¹æ³•ã‚’å…·ä½“çš„ã«æç¤º',
      'æƒ…å ±éå¤š': 'ã€Œæƒ…å ±ã®æµ·ã«æººã‚Œãã†ã§ã™ã‚ˆã­ã€ã¨å…±æ„Ÿã—ã€å³é¸ã•ã‚ŒãŸæœ¬è³ªçš„ãªæƒ…å ±ã¨å„ªå…ˆé †ä½ä»˜ã‘ã®æ–¹æ³•ã‚’æä¾›',
      'ç¶™ç¶šã§ããªã„': 'ã€Œç§ã‚‚ä½•åº¦ã‚‚æŒ«æŠ˜ã—ã¾ã—ãŸã€ã¨æ­£ç›´ã«ä¼ãˆã€å¿ƒç†çš„ãƒãƒ¼ãƒ‰ãƒ«ã‚’ä¸‹ã’ã‚‹å°ã•ãªç¿’æ…£åŒ–ã®æŠ€è¡“ã‚’ç´¹ä»‹',
      'æˆæœãŒå‡ºãªã„': 'ã€Œç›®ã«è¦‹ãˆã‚‹æˆæœãŒãªã„ã¨ã¤ã‚‰ã„ã§ã™ã‚ˆã­ã€ã¨ç†è§£ã‚’ç¤ºã—ã€å°ã•ãªæˆåŠŸä½“é¨“ã‚’ç©ã¿é‡ã­ã‚‹æ–¹æ³•ã‚’ææ¡ˆ',
      'ä½•ã‹ã‚‰å§‹ã‚ã‚Œã°ã„ã„ã‹ã‚ã‹ã‚‰ãªã„': 'ã€Œæœ€åˆã®ä¸€æ­©ãŒæœ€ã‚‚é›£ã—ã„ã§ã™ã‚ˆã­ã€ã¨å…±æ„Ÿã—ã€æ˜ç¢ºãªåˆå¿ƒè€…å‘ã‘ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚’æç¤º',
      'ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒ': 'ã€Œèª°ã§ã‚‚ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ³¢ãŒã‚ã‚Šã¾ã™ã€ã¨æ­£å¸¸åŒ–ã—ã€å†…ç™ºçš„å‹•æ©Ÿä»˜ã‘ã‚’é«˜ã‚ã‚‹å…·ä½“çš„ãªæ–¹æ³•ã‚’ææ¡ˆ',
      'å°‚é–€ç”¨èªãŒé›£ã—ã„': 'ã€Œç§ã‚‚æœ€åˆã¯å°‚é–€ç”¨èªã®å£ã«è‹¦åŠ´ã—ã¾ã—ãŸã€ã¨å…±æœ‰ã—ã€å¹³æ˜“ãªè¨€è‘‰ã§ã®èª¬æ˜ã¨å¾ã€…ã«æ…£ã‚Œã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æä¾›'
    };
    
    return approaches[challenge] || `ã€Œ${challenge}ã¯æœ¬å½“ã«å¤§å¤‰ã§ã™ã‚ˆã­ã€ã¨å…±æ„Ÿã—ã¤ã¤ã€æ®µéšçš„ã«å…‹æœã™ã‚‹ãŸã‚ã®å…·ä½“çš„æ–¹æ³•ã‚’ææ¡ˆ`;
  }

  // è©³ç´°ãªæ–‡ä½“ãƒ»å£èª¿è¨­å®š
  buildDetailedToneSection() {
    const { writerCharacter, writingStyle } = this.userInputs;
    
    let toneSection = `# æ–‡ä½“ãƒ»å£èª¿ã®è©³ç´°è¨­å®š\n\n`;
    
    // åŸºæœ¬å£èª¿
    toneSection += `## åŸºæœ¬çš„ãªå£èª¿\n`;
    toneSection += `- èªå°¾: ${writerCharacter?.tone || 'ã§ã™ãƒ»ã¾ã™èª¿'}\n`;
    toneSection += `- æ–‡ä½“: ${writingStyle?.conversational ? 'ä¼šè©±çš„ã§è¦ªã—ã¿ã‚„ã™ã„' : 'ä¸å¯§ã§è§£èª¬çš„ãª'}æ–‡ä½“\n`;
    
    // å…·ä½“çš„ãªæ–‡ä½“æŒ‡ç¤º
    if (writingStyle?.conversational) {
      toneSection += `\n## ä¼šè©±çš„æ–‡ä½“ã®å…·ä½“ä¾‹:\n`;
      toneSection += `- ã€Œã€œã§ã™ã‚ˆã­ã€ã€Œã€œã ã¨æ€ã†ã‚“ã§ã™ã€ãªã©ã®å…±æ„Ÿè¡¨ç¾ã‚’ä½¿ç”¨\n`;
      toneSection += `- ã€Œå®Ÿã¯ã€ã€Œã¡ãªã¿ã«ã€ãªã©ã®æ¥ç¶šè¡¨ç¾ã§è¦ªè¿‘æ„Ÿã‚’æ¼”å‡º\n`;
      toneSection += `- èª­è€…ã¸ã®ç›´æ¥çš„ãªå•ã„ã‹ã‘ã‚’é©åº¦ã«å«ã‚ã‚‹\n`;
    } else {
      toneSection += `\n## è§£èª¬çš„æ–‡ä½“ã®å…·ä½“ä¾‹:\n`;
      toneSection += `- ã€Œã€œã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€ã€Œã€œã‚’è§£èª¬ã„ãŸã—ã¾ã™ã€ãªã©ã®ä¸å¯§ãªè¡¨ç¾\n`;
      toneSection += `- è«–ç†çš„ãªå±•é–‹ã¨æ˜ç¢ºãªæ§‹é€ ã‚’é‡è¦–\n`;
      toneSection += `- å°‚é–€ç”¨èªã¯å¿…ãšåˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜\n`;
    }
    
    // çµµæ–‡å­—ä½¿ç”¨ã‚¬ã‚¤ãƒ‰
    const emojiGuide = this.getEmojiGuide(writingStyle?.emojiFrequency);
    toneSection += `\n## çµµæ–‡å­—ä½¿ç”¨æ–¹é‡:\n${emojiGuide}\n`;
    
    toneSection += `\n**é‡è¦**: è¨­å®šã•ã‚ŒãŸå£èª¿ã‚’ä¸€è²«ã—ã¦ä¿ã¡ã€èª­è€…ãŒã€Œã“ã®äººã‚‰ã—ã„ã€ã¨æ„Ÿã˜ã‚‹æ–‡ç« ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚`;
    
    return toneSection;
  }

  // çµµæ–‡å­—ä½¿ç”¨ã‚¬ã‚¤ãƒ‰
  getEmojiGuide(frequency) {
    const guides = {
      'none': 'çµµæ–‡å­—ã¯ä¸€åˆ‡ä½¿ç”¨ã—ãªã„',
      'minimal': 'è¨˜äº‹ã®çµ‚ã‚ã‚Šã‚„é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã§ã®ã¿1-2å€‹ä½¿ç”¨ï¼ˆä¾‹ï¼šâœ¨ã€ğŸ’¡ï¼‰',
      'moderate': 'å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«1-2å€‹ç¨‹åº¦ã€èª­ã¿ã‚„ã™ã•ã‚’å‘ä¸Šã•ã›ã‚‹ç›®çš„ã§ä½¿ç”¨',
      'frequent': 'è¦ªã—ã¿ã‚„ã™ã•ã‚’é‡è¦–ã—ã€æ®µè½ã”ã¨ã«é©åˆ‡ãªçµµæ–‡å­—ã‚’ä½¿ç”¨ï¼ˆéåº¦ã«ãªã‚‰ãªã„ç¯„å›²ã§ï¼‰'
    };
    
    return guides[frequency] || guides.moderate;
  }

  // ä¸€æ¬¡æƒ…å ±ã®æ´»ç”¨æŒ‡ç¤º
  buildPrimaryInfoSection() {
    const { primaryInfo } = this.userInputs;
    
    if (!primaryInfo?.facts && !primaryInfo?.feelings) {
      return null;
    }
    
    let primarySection = `# ä¸€æ¬¡æƒ…å ±ã®æ´»ç”¨æŒ‡ç¤º\n\n`;
    
    if (primaryInfo.facts) {
      primarySection += `## äº‹å®Ÿãƒ»ä½“é¨“è«‡ã®æ´»ç”¨:\n`;
      primarySection += `ä»¥ä¸‹ã®äº‹å®Ÿã‚’è¨˜äº‹ã®ä¿¡é ¼æ€§ã‚’é«˜ã‚ã‚‹å…·ä½“ä¾‹ã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼š\n`;
      primarySection += `ã€Œ${primaryInfo.facts}ã€\n\n`;
      primarySection += `**æ´»ç”¨æ–¹æ³•**: æŠ½è±¡çš„ãªèª¬æ˜ã§ã¯ãªãã€ã“ã®å…·ä½“çš„ãªä½“é¨“ã‚’å…ƒã«èª¬å¾—åŠ›ã®ã‚ã‚‹æ–‡ç« ã‚’æ§‹ç¯‰\n\n`;
    }
    
    if (primaryInfo.feelings) {
      primarySection += `## æ„Ÿæƒ…ãƒ»æ„Ÿæƒ³ã®æ´»ç”¨:\n`;
      primarySection += `ä»¥ä¸‹ã®æ„Ÿæƒ…ä½“é¨“ã‚’èª­è€…ã¨ã®å…±æ„Ÿãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼š\n`;
      primarySection += `ã€Œ${primaryInfo.feelings}ã€\n\n`;
      primarySection += `**æ´»ç”¨æ–¹æ³•**: èª­è€…ãŒã€Œã“ã®äººã®æ°—æŒã¡åˆ†ã‹ã‚‹ã€ã¨æ„Ÿã˜ã‚‹ã‚ˆã†ãªæ¸©åº¦æ„Ÿã§è¡¨ç¾\n\n`;
    }
    
    primarySection += `**é‡è¦**: äº‹å®Ÿã¨æ„Ÿæƒ…ã‚’é©åˆ‡ã«çµ„ã¿åˆã‚ã›ã€èª­è€…ã«ãƒªã‚¢ãƒ«ãªä½“é¨“ã¨ã—ã¦ä¼ã‚ã‚‹æ–‡ç« ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚`;
    
    return primarySection;
  }

  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰çµ±åˆæŒ‡ç¤ºã¨ç›®çš„ï¼ˆå¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
  buildKeywordAndPurposeSection() {
    const { keywords, purpose } = this.userInputs;
    
    let section = `# è¨˜äº‹ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ç›®çš„ï¼ˆå¿…é ˆï¼‰\n\n`;
    
    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¿…é ˆï¼‰
    section += `## å¯¾è±¡ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:\n`;
    
    if (keywords && keywords.length > 0) {
      keywords.forEach((keyword, index) => {
        section += `${index + 1}. ${keyword}\n`;
      });
      
      section += `\n## ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ´»ç”¨ã®å¿…é ˆè¦ä»¶:\n`;
      section += `- ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€Œ${keywords[0]}ã€: è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã«å¿…ãšå«ã‚ã€å„è¦‹å‡ºã—ã§ã‚‚è¨€åŠã™ã‚‹\n`;
      
      if (keywords.length > 1) {
        section += `- ã‚µãƒ–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${keywords.slice(1).join('ã€')}\n`;
        section += `  ã“ã‚Œã‚‰ã¯è‡ªç„¶ãªæ–‡è„ˆã§æœ¬æ–‡ã«ç¹”ã‚Šè¾¼ã¿ã€ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã®é–¢é€£æ€§ã‚’ç¤ºã™\n`;
      }
      
      section += `\n## ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä½¿ç”¨ã®æ³¨æ„äº‹é …:\n`;
      section += `- å„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯è¨˜äº‹å…¨ä½“ã§æœ€ä½2-3å›ã¯è‡ªç„¶ã«è¨€åŠã™ã‚‹ã“ã¨\n`;
      section += `- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä¸è‡ªç„¶ãªè©°ã‚è¾¼ã¿ã¯é¿ã‘ã€èª­è€…ã«ã¨ã£ã¦ä¾¡å€¤ã®ã‚ã‚‹æ–‡è„ˆã§ã®ã¿ä½¿ç”¨\n`;
      section += `- SEOã‚’æ„è­˜ã—ã¤ã¤ã‚‚ã€èª­ã¿ã‚„ã™ã•ã‚’æœ€å„ªå…ˆã¨ã™ã‚‹\n\n`;
    } else {
      section += `1. ãƒ†ãƒ¼ãƒï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰\n\n`;
      section += `## ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šã®é‡è¦æ€§:\n`;
      section += `- è¨˜äº‹ã®ç„¦ç‚¹ã‚’æ˜ç¢ºã«ã™ã‚‹ãŸã‚ã€å…·ä½“çš„ãªãƒ†ãƒ¼ãƒã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ„è­˜ã—ã¦åŸ·ç­†ã—ã¦ãã ã•ã„\n\n`;
    }
    
    // ç›®çš„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¿…é ˆï¼‰
    section += `## è¨˜äº‹ã®ç›®çš„:\n`;
    
    if (purpose && purpose.trim()) {
      section += `ã€Œ${purpose}ã€\n\n`;
      section += `## ç›®çš„é”æˆã®ãŸã‚ã®åŸ·ç­†æ–¹é‡:\n`;
      section += `- ã“ã®ç›®çš„ã‚’å¸¸ã«æ„è­˜ã—ã¦ã€è¨˜äº‹ã®å„éƒ¨åˆ†ãŒã“ã®ç›®çš„ã«æ²¿ã†ã‚ˆã†ã«æ§‹æˆã—ã¦ãã ã•ã„\n`;
      section += `- èª­è€…ãŒã“ã®è¨˜äº‹ã‚’èª­ã¿çµ‚ãˆãŸå¾Œã€å…·ä½“çš„ã«ä½•ã‚’å¾—ã‚‰ã‚Œã‚‹ã‹ã€ã©ã®ã‚ˆã†ãªè¡Œå‹•ã‚’å–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã‹ã‚’æ˜ç¢ºã«ã—ã¦ãã ã•ã„\n`;
      section += `- ç›®çš„ã¨é–¢é€£ã—ãªã„ä½™åˆ†ãªæƒ…å ±ã¯çœç•¥ã—ã€ç›®çš„é”æˆã«å¿…è¦ãªæƒ…å ±ã«é›†ä¸­ã—ã¦ãã ã•ã„\n\n`;
    } else {
      section += `ã€Œèª­è€…ã«ä¾¡å€¤ã‚ã‚‹æƒ…å ±ã‚’æä¾›ã—ã€å…·ä½“çš„ãªè¡Œå‹•ã«ã¤ãªã’ã‚‹ã€\n\n`;
      section += `## ç›®çš„è¨­å®šã®é‡è¦æ€§:\n`;
      section += `- æ˜ç¢ºãªç›®çš„ã‚’æŒã£ãŸè¨˜äº‹ã¯èª­è€…ã«ã¨ã£ã¦ä¾¡å€¤ãŒé«˜ããªã‚Šã¾ã™\n`;
      section += `- èª­è€…ã®èª²é¡Œè§£æ±ºã‚„çŸ¥è­˜å‘ä¸Šã«è²¢çŒ®ã™ã‚‹å†…å®¹ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„\n\n`;
    }
    
    section += `**æœ€é‡è¦**: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ç›®çš„ã¯è¨˜äº‹ä½œæˆã«ãŠã„ã¦æœ€ã‚‚é‡è¦ãªè¦ç´ ã§ã™ã€‚ã“ã‚Œã‚‰ã‚’ç„¡è¦–ã—ãŸè¨˜äº‹ã¯ä½œæˆã—ãªã„ã§ãã ã•ã„ã€‚`;
    
    return section;
  }

  // æ§‹æˆã¨æ–‡å­—æ•°ã®æ˜ç¢ºåŒ–
  buildStructureAndWordCountSection() {
    const { writingStyle, wordCount } = this.userInputs;
    
    let structureSection = `# æ§‹æˆã¨æ–‡å­—æ•°ã®æ˜ç¢ºåŒ–\n\n`;
    
    // æ§‹æˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    const template = this.getStructureTemplate(writingStyle?.template);
    structureSection += `## è¨˜äº‹æ§‹æˆï¼ˆ${writingStyle?.template || 'prep'}æ³•ï¼‰:\n`;
    structureSection += template;
    
    // æ–‡å­—æ•°æŒ‡ç¤º
    structureSection += `\n## æ–‡å­—æ•°è¦ä»¶:\n`;
    structureSection += `- ç›®æ¨™æ–‡å­—æ•°: ${wordCount || 3000}æ–‡å­—\n`;
    structureSection += `- èª­äº†æ™‚é–“: ç´„${Math.ceil((wordCount || 3000) / 400)}åˆ†\n`;
    structureSection += `- å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€å†…å®¹ã®æ¿ƒã„æ–‡ç« ã‚’ä½œæˆ\n`;
    
    // é•·æ–‡è¨˜äº‹å‘ã‘è¿½åŠ æŒ‡ç¤º
    if (wordCount >= 5000) {
      structureSection += `\n## é•·æ–‡è¨˜äº‹ã®æ§‹æˆã‚¬ã‚¤ãƒ‰:\n`;
      structureSection += `- ç›®æ¬¡ã‚’æœ€åˆã«é…ç½®ã—ã€å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›\n`;
      structureSection += `- å„ãƒˆãƒ”ãƒƒã‚¯ã‚’ç‹¬ç«‹ã—ãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦è©³ç´°ã«å±•é–‹\n`;
      structureSection += `- ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ã®é–¢é€£æ€§ã¨ä¸€è²«æ€§ã‚’ä¿ã¤\n`;
      structureSection += `- èª­è€…ãŒé€”ä¸­ã§èª­ã‚€ã®ã‚’ã‚„ã‚ãªã„ã‚ˆã†ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ã«å°ã•ãªã€Œãƒ•ãƒƒã‚¯ã€ã‚’å…¥ã‚Œã‚‹\n`;
      
      if (wordCount >= 8000) {
        structureSection += `- ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã€èª­è€…ã®ç–‘å•ã«å…ˆå›ã‚Šã—ã¦ç­”ãˆã‚‹\n`;
        structureSection += `- å®Ÿè·µä¾‹ã‚„äº‹ä¾‹ç ”ç©¶ã‚’å«ã‚ã¦å…·ä½“æ€§ã‚’é«˜ã‚ã‚‹\n`;
      }
    }
    
    // çŸ­æ–‡å‘ã‘æŒ‡ç¤º
    if (wordCount <= 1000) {
      structureSection += `\n## çŸ­æ–‡è¨˜äº‹ã®æ§‹æˆã‚¬ã‚¤ãƒ‰:\n`;
      structureSection += `- å†—é•·ãªè¡¨ç¾ã‚’é¿ã‘ã€ç°¡æ½”ã§æ˜ç­ãªæ–‡ç« ã‚’å¿ƒãŒã‘ã‚‹\n`;
      structureSection += `- æœ€ã‚‚é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’å„ªå…ˆã—ã€æœ¬è³ªçš„ã§ãªã„æƒ…å ±ã¯çœç•¥\n`;
      structureSection += `- 1ã¤ã®æ®µè½ã¯1ã¤ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã«é›†ä¸­\n`;
      
      if (wordCount <= 140) {
        structureSection += `- SNSæŠ•ç¨¿å‘ã‘ã®è¶…ç°¡æ½”ãªè¡¨ç¾ã‚’ä½¿ç”¨\n`;
        structureSection += `- æ ¸ã¨ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æœ€åˆã«é…ç½®\n`;
        structureSection += `- è¡Œå‹•å–šèµ·ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’å«ã‚ã‚‹\n`;
      }
    }
    
    return structureSection;
  }

  // æ§‹æˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  getStructureTemplate(template) {
    const templates = {
      'prep': `1. **çµè«–**: è¨˜äº‹ã®è¦ç‚¹ã‚’æœ€åˆã«æ˜ç¢ºã«æç¤º\n2. **ç†ç”±**: ãªãœãã®çµè«–ã«è‡³ã‚‹ã®ã‹ã®æ ¹æ‹ ã‚’è©³ã—ãèª¬æ˜\n3. **å…·ä½“ä¾‹**: å®Ÿä½“é¨“ã‚„äº‹ä¾‹ã‚’ç”¨ã„ã¦èª¬å¾—åŠ›ã‚’é«˜ã‚ã‚‹\n4. **çµè«–**: è¦ç‚¹ã‚’å†åº¦å¼·èª¿ã—ã€èª­è€…ã®è¡Œå‹•ã‚’ä¿ƒã™\n`,
      'story': `1. **çŠ¶æ³è¨­å®š**: èª­è€…ã®é–¢å¿ƒã‚’å¼•ãå°å…¥éƒ¨\n2. **å•é¡Œç™ºç”Ÿ**: èª²é¡Œã‚„å›°é›£ã®ç™ºç”Ÿ\n3. **è§£æ±ºéç¨‹**: å–ã‚Šçµ„ã¿ã‚„ç™ºè¦‹ã®ãƒ—ãƒ­ã‚»ã‚¹\n4. **çµæœã¨å­¦ã³**: å¾—ã‚‰ã‚ŒãŸæˆæœã¨æ•™è¨“\n`,
      'problem-solution': `1. **å•é¡Œæèµ·**: èª­è€…ãŒæŠ±ãˆã‚‹å…·ä½“çš„ãªèª²é¡Œ\n2. **åŸå› åˆ†æ**: å•é¡Œã®æ ¹æœ¬åŸå› ã‚’æ¢ã‚‹\n3. **è§£æ±ºç­–æç¤º**: å…·ä½“çš„ã§å®Ÿè·µå¯èƒ½ãªè§£æ±ºæ–¹æ³•\n4. **å®Ÿè¡ŒæŒ‡å—**: å®Ÿéš›ã®å–ã‚Šçµ„ã¿æ–¹æ³•\n`,
      'how-to': `1. **æ¦‚è¦èª¬æ˜**: ä½•ã‚’é”æˆã™ã‚‹ã®ã‹ã®æ˜ç¢ºåŒ–\n2. **äº‹å‰æº–å‚™**: å¿…è¦ãªçŸ¥è­˜ã‚„æº–å‚™äº‹é …\n3. **å®Ÿè¡Œæ‰‹é †**: ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°èª¬æ˜\n4. **å¿œç”¨ç™ºå±•**: ã•ã‚‰ãªã‚‹æ´»ç”¨æ–¹æ³•ã‚„ç™ºå±•å¯èƒ½æ€§\n`,
      'comparison': `1. **é¸æŠè‚¢æç¤º**: è¤‡æ•°ã®æ–¹æ³•ã‚„é¸æŠè‚¢ã®æ¦‚è¦\n2. **è©³ç´°æ¯”è¼ƒ**: å„é¸æŠè‚¢ã®ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ\n3. **è©•ä¾¡åŸºæº–**: å®¢è¦³çš„ãªåˆ¤æ–­åŸºæº–ã®æç¤º\n4. **æ¨å¥¨ææ¡ˆ**: æœ€é©ãªé¸æŠè‚¢ã¨ãã®ç†ç”±\n`
    };
    
    return templates[template] || templates.prep;
  }

  // å‡ºåŠ›å“è³ªã®è¦æ±‚
  buildQualityRequirementsSection() {
    return `# å‡ºåŠ›å“è³ªã®è¦æ±‚

## å¿…é ˆè¦ä»¶:
1. **å…·ä½“æ€§**: æŠ½è±¡çš„ãªè¡¨ç¾ã‚’é¿ã‘ã€å…·ä½“çš„ãªä¾‹ã‚„æ•°å­—ã‚’å¤šç”¨
2. **ç‹¬è‡ªæ€§**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆçš„ãªè¡¨ç¾ã‚’é¿ã‘ã€å€‹æ€§çš„ãªæ–‡ç« ã‚’ä½œæˆ
3. **å®Ÿç”¨æ€§**: èª­è€…ãŒå®Ÿéš›ã«æ´»ç”¨ã§ãã‚‹ä¾¡å€¤ã‚ã‚‹æƒ…å ±ã‚’æä¾›
4. **èª­ã¿ã‚„ã™ã•**: é©åˆ‡ãªæ”¹è¡Œã¨æ®µè½åˆ†ã‘ã§èª­ã¿ã‚„ã™ã„æ§‹æˆ
5. **ä¸€è²«æ€§**: è¨­å®šã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨æ–‡ä½“ã‚’æœ€å¾Œã¾ã§ç¶­æŒ
6. **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ´»ç”¨**: æŒ‡å®šã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªç„¶ã«æ–‡ç« ã«çµ„ã¿è¾¼ã‚€
7. **ç›®çš„é”æˆ**: è¨­å®šã•ã‚ŒãŸè¨˜äº‹ã®ç›®çš„ã‚’å¿…ãšé”æˆã™ã‚‹

## é¿ã‘ã‚‹ã¹ãè¡¨ç¾:
- ã€Œã€œã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€ãªã©ã®å®šå‹çš„ãªè¡¨ç¾
- ã€Œé‡è¦ã§ã™ã€ã€Œå¤§åˆ‡ã§ã™ã€ãªã©ã®æ›–æ˜§ãªå¼·èª¿
- åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¹°ã‚Šè¿”ã—ï¼ˆã€Œç§ã®çµŒé¨“ã‹ã‚‰ã€œã€ã®å¤šç”¨ãªã©ï¼‰
- è¡¨é¢çš„ã§æ·±ã¿ã®ãªã„å†…å®¹
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ç„¡ç†ãªè©°ã‚è¾¼ã¿

## ç›®æŒ‡ã™ã¹ãå“è³ª:
- èª­è€…ãŒã€Œã“ã®äººã«ã—ã‹æ›¸ã‘ãªã„ã€ã¨æ„Ÿã˜ã‚‹ç‹¬è‡ªæ€§
- æœ€å¾Œã¾ã§é£½ããšã«èª­ã‚ã‚‹æ§‹æˆã¨æ–‡ä½“
- èª­ã¿çµ‚ã‚ã£ãŸå¾Œã«è¡Œå‹•ã‚’èµ·ã“ã—ãŸããªã‚‹èª¬å¾—åŠ›
- äººé–“å‘³ã¨æ¸©ã‹ã¿ãŒæ„Ÿã˜ã‚‰ã‚Œã‚‹æ–‡ç« 
- è‡ªç„¶ã§ã‚ã‚ŠãªãŒã‚‰SEOã‚‚æ„è­˜ã—ãŸå†…å®¹

**æœ€é‡è¦**: ä¸Šè¨˜ã™ã¹ã¦ã®è¨­å®šã‚’çµ±åˆã—ã€èª­è€…ã®å¿ƒã«éŸ¿ãé«˜å“è³ªãªè¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚`;
  }

  // å…·ä½“çš„ãªåŸ·ç­†æŒ‡ç¤º
  buildConcreteWritingInstructions() {
    const { wordCount, keywords, purpose } = this.userInputs;
    
    let instructions = `# å…·ä½“çš„ãªåŸ·ç­†æŒ‡ç¤º

## è¨˜äº‹ä½œæˆã®å¿…é ˆæ‰‹é †:

1. **å°å…¥éƒ¨ï¼ˆ${Math.floor((wordCount || 3000) * 0.15)}æ–‡å­—ç¨‹åº¦ï¼‰**:
- èª­è€…ã®é–¢å¿ƒã‚’å¼•ãå…·ä½“çš„ãªã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚„äº‹å®Ÿã‹ã‚‰å§‹ã‚ã‚‹
- è¨­å®šã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å€‹æ€§ã‚’æœ€åˆã‹ã‚‰è¡¨ç¾ã™ã‚‹
- èª­è€…ã®èª²é¡Œã‚„èˆˆå‘³ã«ç›´æ¥è¨€åŠã™ã‚‹`;

    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å¿…é ˆäº‹é …ã¨ã—ã¦è¿½åŠ 
    if (keywords && keywords.length > 0) {
      instructions += `
- **å¿…é ˆ**: ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€Œ${keywords[0]}ã€ã‚’è‡ªç„¶ã«å°å…¥éƒ¨ã«å«ã‚ã‚‹`;
    }
    
    // ç›®çš„ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å¿…é ˆäº‹é …ã¨ã—ã¦è¿½åŠ 
    if (purpose && purpose.trim()) {
      instructions += `
- **å¿…é ˆ**: è¨˜äº‹ã®ç›®çš„ã€Œ${purpose}ã€ã‚’æ„è­˜ã—ãŸå°å…¥ã«ã™ã‚‹`;
    }
    
    instructions += `

2. **æœ¬è«–ï¼ˆ${Math.floor((wordCount || 3000) * 0.7)}æ–‡å­—ç¨‹åº¦ï¼‰**:
- å„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã€å…·ä½“çš„ãªä½“é¨“è«‡ã‚„äº‹ä¾‹ã‚’äº¤ãˆã¦èª¬æ˜
- èª­è€…ã®ãƒšãƒ«ã‚½ãƒŠã«åˆã‚ã›ãŸå…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›
- ä¸€æ¬¡æƒ…å ±ã‚’åŠ¹æœçš„ã«æ´»ç”¨ã—ã¦èª¬å¾—åŠ›ã‚’é«˜ã‚ã‚‹`;

    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆã®æœ¬è«–ã§ã®æ´»ç”¨æŒ‡ç¤º
    if (keywords && keywords.length > 1) {
      instructions += `
- **å¿…é ˆ**: ã‚µãƒ–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€Œ${keywords.slice(1).join('ã€')}ã€ã‚’è‡ªç„¶ã«æœ¬è«–ã«ç¹”ã‚Šè¾¼ã‚€`;
    }
    
    instructions += `

3. **çµè«–ï¼ˆ${Math.floor((wordCount || 3000) * 0.15)}æ–‡å­—ç¨‹åº¦ï¼‰**:
- è¨˜äº‹ã®è¦ç‚¹ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã‚‹
- èª­è€…ã®è¡Œå‹•ã‚’ä¿ƒã™å…·ä½“çš„ãªææ¡ˆ
- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚‰ã—ã„ç· ã‚ããã‚Š`;

    // ç›®çš„ãŒã‚ã‚‹å ´åˆã®çµè«–ã§ã®è¨€åŠæŒ‡ç¤º
    if (purpose && purpose.trim()) {
      instructions += `
- **å¿…é ˆ**: è¨˜äº‹ã®ç›®çš„é”æˆã‚’ç¢ºèªã§ãã‚‹çµè«–ã«ã™ã‚‹`;
    }
    
    instructions += `

## æ–‡ç« ä½œæˆã®å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ:
- **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç¢ºèª**: æŒ‡å®šã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã™ã¹ã¦è‡ªç„¶ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹
- **ç›®çš„é”æˆç¢ºèª**: è¨­å®šã•ã‚ŒãŸè¨˜äº‹ã®ç›®çš„ãŒé”æˆã•ã‚Œã¦ã„ã‚‹ã‹
- **æ–‡å­—æ•°ç¢ºèª**: ç›®æ¨™æ–‡å­—æ•°${wordCount || 3000}æ–‡å­—ã«é”ã—ã¦ã„ã‚‹ã‹
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åæ˜ **: è¨­å®šã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å€‹æ€§ãŒæ–‡ç« ã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹
- **èª­è€…é©åˆ**: èª­è€…ã®ãƒšãƒ«ã‚½ãƒŠã«é©ã—ãŸå†…å®¹ã«ãªã£ã¦ã„ã‚‹ã‹
- **å®Ÿç”¨æ€§ç¢ºèª**: å…·ä½“çš„ã§å®Ÿç”¨çš„ãªå†…å®¹ã«ãªã£ã¦ã„ã‚‹ã‹

## å“è³ªä¿è¨¼ã®ãŸã‚ã®æœ€çµ‚ç¢ºèª:
1. è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã«ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
2. å„è¦‹å‡ºã—ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒé©åˆ‡ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹
3. è¨˜äº‹ã®ç›®çš„ãŒæ˜ç¢ºã«èª­è€…ã«ä¼ã‚ã‚‹ã‹
4. èª­è€…ãŒå…·ä½“çš„ãªè¡Œå‹•ã‚’å–ã‚Œã‚‹å†…å®¹ã«ãªã£ã¦ã„ã‚‹ã‹
5. è¨­å®šã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚‰ã—ã•ãŒä¸€è²«ã—ã¦è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã‹

**çµ¶å¯¾å³å®ˆ**: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ç›®çš„ã¯è¨˜äº‹ã®æ ¸å¿ƒéƒ¨åˆ†ã§ã™ã€‚ã“ã‚Œã‚‰ã‚’è»½è¦–ã—ãŸã‚Šçœç•¥ã—ãŸã‚Šã™ã‚‹ã“ã¨ã¯çµ¶å¯¾ã«é¿ã‘ã¦ãã ã•ã„ã€‚`;

    return instructions;
  }

  // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆå¼·åŒ–ç‰ˆï¼‰
  generateAPIPrompt() {
    const mainPrompt = this.generateMainPrompt();
    
    return {
      system: `ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œã§å€‹æ€§çš„ãªWebãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®è©³ç´°ãªè¨­å®šã«åŸºã¥ã„ã¦ã€èª­è€…ã®å¿ƒã«éŸ¿ãé«˜å“è³ªãªè¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

é‡è¦ãªæŒ‡é‡:
1. è¨­å®šã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å€‹æ€§ã‚’æ–‡ç« ã®éš…ã€…ã¾ã§åæ˜ ã•ã›ã‚‹
2. èª­è€…ã®ãƒšãƒ«ã‚½ãƒŠã‚’å…·ä½“çš„ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã€ãã®äººã«ç›´æ¥èªã‚Šã‹ã‘ã‚‹
3. ä¸€æ¬¡æƒ…å ±ï¼ˆä½“é¨“è«‡ï¼‰ã‚’åŠ¹æœçš„ã«æ´»ç”¨ã—ã¦èª¬å¾—åŠ›ã‚’é«˜ã‚ã‚‹
4. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆçš„ãªè¡¨ç¾ã‚’é¿ã‘ã€ç‹¬è‡ªæ€§ã®ã‚ã‚‹æ–‡ç« ã‚’ä½œæˆ
5. æŒ‡å®šã•ã‚ŒãŸæ–‡å­—æ•°ã‚’å³å®ˆã™ã‚‹
6. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ç›®çš„ã‚’æœ€å„ªå…ˆã§è¨˜äº‹ã«çµ„ã¿è¾¼ã‚€ï¼ˆå¿…é ˆï¼‰

å“è³ªåŸºæº–:
- å…·ä½“çš„ã§å®Ÿç”¨çš„ãªå†…å®¹
- èª­è€…ãŒæœ€å¾Œã¾ã§é£½ããªã„æ§‹æˆ
- äººé–“å‘³ã¨æ¸©ã‹ã¿ã®ã‚ã‚‹æ–‡ä½“
- è¡Œå‹•ã‚’èµ·ã“ã—ãŸããªã‚‹èª¬å¾—åŠ›
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®è‡ªç„¶ãªæ´»ç”¨
- è¨˜äº‹ç›®çš„ã®ç¢ºå®Ÿãªé”æˆ`,
      user: mainPrompt,
      temperature: 0.7,
      max_tokens: 4000,
      top_p: 0.9
    };
  }

  // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å¦¥å½“æ€§æ¤œè¨¼
  validatePrompt() {
    const prompt = this.generateMainPrompt();
    
    // å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç¢ºèª
    const requiredSections = [
      'ã‚ãªãŸã®å½¹å‰²ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š',
      'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆèª­è€…ã®è©³ç´°è¨­å®š',
      'æ–‡ä½“ãƒ»å£èª¿ã®è©³ç´°è¨­å®š',
      'è¨˜äº‹ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ç›®çš„ï¼ˆå¿…é ˆï¼‰',
      'æ§‹æˆã¨æ–‡å­—æ•°ã®æ˜ç¢ºåŒ–'
    ];
    
    const missingSections = requiredSections.filter(section => !prompt.includes(section));
    
    if (missingSections.length > 0) {
      console.warn(`Missing sections: ${missingSections.join(', ')}`);
      return false;
    }
    
    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ç›®çš„ã®å­˜åœ¨ç¢ºèª
    const hasKeywords = prompt.includes('å¯¾è±¡ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:');
    const hasPurpose = prompt.includes('è¨˜äº‹ã®ç›®çš„:');
    
    if (!hasKeywords || !hasPurpose) {
      console.warn('Missing keywords or purpose section');
      return false;
    }
    
    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®é•·ã•ç¢ºèª
    if (prompt.length < 1500) {
      console.warn('Prompt might be too short for detailed generation');
      return false;
    }
    
    return true;
  }
}

// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
export const generateArticlePrompt = (userInputs) => {
  const generator = new PromptGenerator(userInputs);
  return generator.generateAPIPrompt();
};

// ç©ºã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å‡¦ç†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®æ”¹å–„ï¼‰
export const handleEmptyProperties = (userInputs) => {
  const defaults = {
    keywords: ['ãƒ†ãƒ¼ãƒ'],
    purpose: 'èª­è€…ã«ä¾¡å€¤ã‚ã‚‹æƒ…å ±ã‚’æä¾›ã™ã‚‹',
    readerPersona: {
      age: '30ä»£',
      occupation: 'ä¼šç¤¾å“¡',
      readingStyle: 'ã˜ã£ãã‚Šèª­ã‚€',
      interests: ['è‡ªå·±æˆé•·'],
      challenges: ['æ™‚é–“ãŒãªã„']
    },
    writerCharacter: {
      age: '30',
      occupation: 'ãƒ©ã‚¤ã‚¿ãƒ¼',
      personalities: ['è¦ªã—ã¿ã‚„ã™ã„'],
      tone: 'ã§ã™ãƒ»ã¾ã™èª¿',
      motivations: ['çŸ¥è­˜ã‚’å…±æœ‰ã—ãŸã„']
    },
    writingStyle: {
      conversational: true,
      template: 'prep',
      emojiFrequency: 'moderate'
    },
    primaryInfo: {
      facts: '',
      feelings: ''
    },
    wordCount: 3000
  };
  
  return { ...defaults, ...userInputs };
};